<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./style/core.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
        <title>NunuSpace</title>
    </head>
<body>
    <section class="hero is-medium is-success">


        <div class="hero-body">
          <p class="title">
            <a href="./index.html">UBB-INFO iulie 2022</a>
          </p>
          <p class="subtitle">
            <a class="is-info" target="_blank" href="https://www.cs.ubbcluj.ro/files/admitere/2022-iulie/licenta/subiecte/Informatica%20raspunsuri%20%28toate%20limbile%29%20iulie%202022.pdf">
                BAREM
            </a>
          </p>
        </div>
      </section>

    <div class="container central bb">
        <embed
        src="info/Informatica-2022-iulie.pdf"
        type="application/pdf"
        width="100%"
        height="100%"
        />
    </div>

    <section class="section">
        <div class="container central bb">
            <p class="title is-2">GRILE:</p>
            <div id="formx" class="tile align">

            </div>
                    
            <footer>
                <div class="qtx">
                    <div class="control">
                        <button onclick="calculate()" class="button is-success">Calculeaza</button>
                    </div>
                </div>
            </footer>
        </div>
    </section>
</body>

<script>
    let arr = [];
    let true_ans = [];

    let answers = [
        ['B'],
        ['A'],
        ['B','C'],
        ['D'],
        ['C','D'],

        ['A'],
        ['B','D'],
        ['B'],
        ['B','C'],
        ['B'],

        ['C'],
        ['D'],
        ['C'],
        ['B'],
        ['A'],

        ['D'],
        ['B'],
        ['B'],
        ['C'],
        ['B','C','D'], 

        ['C'],
        ['A','B','C'],
        ['B'],
        ['A','C','D'],
        ['A','C','D'],

        ['A','C'],
        ['A','B','D'],
        ['A'],
        ['C','D'],
        ['C','D']
    ];

    const conv_letter = (l) => {
        if(l == "A") return 0;
        else if(l == "B") return 1;
        else if(l == "C") return 2;
        return 3;
    }

    const conv_j = (l) => {
        if(l == 0) return "A";
        else if(l == 1) return "B";
        else if(l == 2) return "C";
        return "D";
    }

    window.onload = () => {
        answers.map((el,index) => {
            let true_in = index + 1;
            true_ans[true_in] = [];

            for(let k = 0; k < 4; k++)
                true_ans[true_in][k] = false;

            el.map((ans) => {
                let c = conv_letter(ans);
                true_ans[true_in][c] = true;
            })
        })

        for(let i = 1; i <= 30; i++){
            arr[i] = [];

            for(let j = 0; j < 4; j++) {
                arr[i][j] = false;
            }

        document.getElementById("formx").innerHTML += `
            <div class="dist alg" id="${i}">
                <h1>${i}</h1>
                <div class="align">
                    <p class="control">
                        <a id="A${i}" class="button tt">
                            A
                        </a>
                    </p>
                    <p class="control">
                        <a id="B${i}" class="button tt">
                            B
                        </a>
                    </p>
                    <p class="control">
                        <a id="C${i}" class="button tt">
                            C
                        </a>
                    </p>
                    <p class="control">
                        <a id="D${i}" class="button tt">
                            D
                        </a>
                    </p>
                </div>
            </div>
            `
        }

        let all_btns = document.getElementsByClassName("tt");
        all_btns = Array.from(all_btns);

        all_btns.map((el) => {
            el.addEventListener("click", () => {
                if(el.style.background == "gray")
                    el.style.background = "white";
                else el.style.background = "gray";

                console.log(el.id);
                let letter = el.id[0], num = el.id.substring(1);
                letter = conv_letter(letter);

                arr[num][letter] = !arr[num][letter];

                console.log(arr[num][letter]);
            })
        })
    }
    let max = (a,b) => {
        if(a>b) return a;
        return b;
    }

    const calculate = () => {
        let punctaj = 10, maxim = 3;
        console.log(true_ans);
        console.log(arr);

        let msgbody = "";

        for(let i = 1; i<= 30; i++){
            let gresite = 0, ratate = 0, corecte = 0;

            let imsg = "";

            for(let j = 0; j < 4; j++){
                if(true_ans[i][j] == arr[i][j] && arr[i][j] == true) {
                    corecte++;
                }
                else if(true_ans[i][j] == true && arr[i][j] == false) {
                    ratate++;
                    let rl = conv_j(j);
                    imsg += `Nu ai bifat litera ${rl}\n`
                }
                else if(true_ans[i][j] == false && arr[i][j] == true) {
                    gresite++;
                    let wl = conv_j(j);
                    imsg += `Ai bifat incorect litera ${wl}\n`
                }
            }

            let totale = corecte + ratate;

            console.log(corecte, ratate,gresite);

            let penalizare = gresite * 0.66 * 3.0 /(totale);
            let castigat = corecte * 3.0 / totale;

            castigat = max(0, castigat - penalizare);

            if(castigat != maxim){
                msgbody += `${i}:\n${imsg}\n`;
            }

            punctaj += castigat;
        }

        punctaj = Number(punctaj).toFixed(2);

        msgbody = `Punctaj ${punctaj}\n\n` + msgbody;

        alert(msgbody);
    }

    //window.onbeforeunload = function() {return "pls naw";}

</script>
</html>